const csvUrl="https://docs.google.com/spreadsheets/d/e/2PACX-1vRr62BlKCzICpC0ctnU2mRB8cq_SOCcsgydXQJXD5pQvasO1b1iT0Wp_L7sFxH8UGJCepaMjng1GUO0/pub?gid=1610793698&single=true&output=csv",cotizacionUrl="https://docs.google.com/spreadsheets/d/e/2PACX-1vQJ7PS8pvnCKdpLgJFonsZNN54Rs8oTpzGgCxhbfZzd3KmKb9k12OEwgAWuDAHiIPraWKxoS5TlCm4X/pub?gid=0&single=true&output=csv";fetch("https://docs.google.com/spreadsheets/d/e/2PACX-1vQJ7PS8pvnCKdpLgJFonsZNN54Rs8oTpzGgCxhbfZzd3KmKb9k12OEwgAWuDAHiIPraWKxoS5TlCm4X/pub?gid=0&single=true&output=csv").then(e=>e.text()).then(e=>{let[t]=e.trim().split("\n"),a=t?.split(",")[0]?.replace(",",".")||"N/A";document.getElementById("dolarValor").textContent=a}).catch(e=>{console.error("Error al obtener d\xf3lar:",e),document.getElementById("dolarValor").textContent="Error"});const fechaFormateada=new Intl.DateTimeFormat("es-AR").format(new Date);document.getElementById("fechaActual").textContent=fechaFormateada,window.addEventListener("load",()=>{let e=document.getElementById("logo-desktop");e&&(e.src+=`?v=${Date.now()}`)});const loader=document.querySelector(".loader-local");function procesarCategoriasDesdeCSV(e){let t=[],a=null,r=[],s=[],n=!1;return e.forEach(e=>{let l=e.map(e=>(e||"").trim()),o=l.filter(Boolean);if(1===o.length&&o[0]===o[0].toUpperCase()){a&&r.length&&t.push({nombre:a,headers:r,productos:s}),a=o[0],r=[],s=[],n=!0;return}if(n){r=l,n=!1;return}r.length&&s.push(l)}),a&&r.length&&t.push({nombre:a,headers:r,productos:s}),t}function renderCategorias(e){let t=document.getElementById("categoriasContainer"),a=document.getElementById("plantilla-categoria");t.innerHTML="",e.forEach((e,r)=>{let s=`cat-${r}`,n=e.headers,l=e.productos,o=n.indexOf("Ocultar");n.indexOf("Detalles");let i=n.indexOf("Fotos"),d=n.indexOf("Specs"),c=n.indexOf("L"),p=-1!==d&&l.some(e=>""!==e[d]?.trim()),u=-1!==c&&l.some(e=>""!==e[c]?.trim()),b=n.findIndex((e,t)=>t!==o),m=a.content.cloneNode(!0);m.querySelector(".accordion");let g=m.querySelector(".accordion-button"),h=m.querySelector(".accordion-collapse"),C=iconosCategorias[e.nombre]||"bi bi-phone",f=`collapse-${s}`,A=`heading-${s}`;g.setAttribute("data-bs-target",`#${f}`),g.setAttribute("aria-controls",f),h.id=f,h.setAttribute("aria-labelledby",A),g.closest("h2").id=A,m.querySelector(".icono-categoria").className=`me-2 icono-categoria ${C}`,m.querySelector(".nombre-categoria").textContent=e.nombre,m.querySelector(".alerta-categoria").innerHTML=renderAlerta(e.nombre);let y=m.querySelector(".encabezados");n.forEach((e,t)=>{if(t===o||t===d&&!p||t===c&&!u)return;let a=document.createElement("th");a.innerHTML=t===c?`<span class="visually-hidden">${e}</span>`:e,[d,c].includes(t)&&a.classList.add("col-centrada"),y.appendChild(a)});let E=m.querySelector(".filas-productos"),L=null;l.filter(e=>-1===o||"x"!==e[o]?.toLowerCase()).forEach(e=>{let t=document.createElement("tr"),a=e.every(e=>""===e);if(a){let r=document.createElement("td");r.colSpan=n.length-(-1!==o?1:0),r.innerHTML="&nbsp;",t.appendChild(r)}else e.forEach((e,a)=>{if(a===o||a===d&&!p||a===c&&!u)return;let r=document.createElement("td");if(a===b){let s=e&&e!==L;L=e||L,r.innerHTML=s?e:`<span class="visually-hidden">${e}</span>`,s&&r.classList.add("fusion-celda"),t.appendChild(r);return}if(a===c&&e){r.classList.add("col-centrada"),r.innerHTML=badges[e]||e,t.appendChild(r);return}if(a===i&&e){let n=document.createElement("button");n.className="btn btn-secondary btn-sm",n.innerHTML='<i class="bi bi-image"></i>',n.title="Ver fotos",n.setAttribute("data-bs-toggle","modal"),n.setAttribute("data-bs-target","#modalFotos"),n.setAttribute("data-fotos",e),n.addEventListener("click",()=>{let t=e.split(",").map(e=>e.trim()).filter(Boolean),a=document.querySelector("#carouselFotos .carousel-inner");a.innerHTML="",t.forEach((e,t)=>{let r=document.createElement("div");r.className="carousel-item"+(0===t?" active":""),r.innerHTML=`<img src="${e}" class="d-block w-75 mx-auto" alt="Foto ${t+1}">`,a.appendChild(r)})}),r.appendChild(n),t.appendChild(r);return}if(a===d&&e){r.classList.add("col-centrada");let l=document.createElement("a");l.className="btn btn-link btn-sm",l.textContent="Ver ficha",l.href=e,l.target="_blank",l.rel="noopener noreferrer",r.appendChild(l),t.appendChild(r);return}r.innerHTML=e||"&nbsp;",t.appendChild(r)});E.appendChild(t)}),t.appendChild(m)})}function renderAlerta(e){let t={"MACBOOK AIR":"Consultanos por versiones custom (Chip MAX, +RAM, etc). Tambi\xe9n traemos iMac, Mac mini, Mac Studio","MACBOOK PRO":"Consultanos por versiones custom (Chip MAX, +RAM, etc). Tambi\xe9n traemos iMac, Mac mini, Mac Studio",IPHONE:"\xa1Combo cargador original (Apple 20W, MWVV3AM) + U$30!",SAMSUNG:"Por otros productos de la marca (Linea Z, Samsung Tab, etc) consultanos por WhatsApp",ACCESORIOS:"Consultar disponibilidad en modelos y colores"};return t[e]?`
    <div class="alert alert-info d-flex justify-content-center align-items-center text-center mb-3 py-2 px-3" role="alert">
      <i class="bi bi-info-circle-fill me-2"></i>
      <div class="small">${t[e]}</div>
    </div>
  `:""}loader?.classList.remove("loader-local-hidden"),Papa.parse("https://docs.google.com/spreadsheets/d/e/2PACX-1vRr62BlKCzICpC0ctnU2mRB8cq_SOCcsgydXQJXD5pQvasO1b1iT0Wp_L7sFxH8UGJCepaMjng1GUO0/pub?gid=1610793698&single=true&output=csv",{download:!0,complete({data:e}){let t=procesarCategoriasDesdeCSV(e);renderCategorias(t),loader?.classList.add("loader-local-hidden")}});const iconosCategorias={IPHONE:"bi-apple",AIRPODS:"bi-earbuds","APPLE WATCH":"bi-smartwatch",AIRTAG:"bi-tag",IPAD:"bi-tablet-fill","MACBOOK AIR":"bi-laptop","MACBOOK PRO":"bi-laptop",PLAYSTATION:"bi-playstation",XBOX:"bi-xbox","NINTENDO SWITCH":"bi-nintendo-switch",VR:"bi-headset-vr",GOPRO:"bi-camera-video",INSTA360:"bi-camera-video",SMARTWATCH:"bi-watch",ACCESORIOS:"bi-bag-plus","DRONE DJI":"bi-robot"},badges={NEW:`<span class="badge bg-warning text-dark">‚úàÔ∏è\xa1NUEVO!</span>`,SALE:`<span class="badge bg-danger">üî•\xa1OFERTA!</span>`,HOT:`<span class="badge bg-primary">üî• HOT</span>`,LIMITED:`<span class="badge bg-info text-dark">‚è≥ LIMITADO</span>`};function filtrarGeneral(){let e=document.getElementById("searchGeneral"),t=e.value.toLowerCase().trim(),a=t?t.split(/\s+/):[],r=document.getElementById("resultadoBusqueda"),s=0;document.querySelectorAll(".accordion-flush").forEach(e=>{let r=e.querySelector(".accordion-button"),n=e.querySelector(".collapse"),l=bootstrap.Collapse.getOrCreateInstance(n,{toggle:!1}),o=Array.from(e.querySelectorAll("tbody tr"));if(!t){e.style.display="",l.hide(),r.classList.add("collapsed"),r.setAttribute("aria-expanded","false"),o.forEach(e=>e.style.display="");return}let i=r.innerText.toLowerCase(),d=!1;o.forEach(e=>{let t=Array.from(e.cells).filter((e,t)=>2!==t).map(e=>e.innerText.toLowerCase()).join(" ")+" "+i,r=a.every(e=>t.includes(e));e.style.display=r&&e.innerText.trim()?"":"none",r&&(d=!0,s++)}),d?(e.style.display="",l.show(),r.classList.remove("collapsed"),r.setAttribute("aria-expanded","true")):(l.hide(),r.classList.add("collapsed"),r.setAttribute("aria-expanded","false"),e.style.display="none")}),t?0===s?(r.innerHTML='<span class="badge bg-danger">Sin resultados. Consultar existencia por WhatsApp</span>',r.classList.add("no-resultado"),r.classList.remove("resultado-encontrado")):(r.innerHTML=`<span class="badge bg-success">${s} resultado${1!==s?"s":""} encontrado${1!==s?"s":""}</span>`,r.classList.add("resultado-encontrado"),r.classList.remove("no-resultado")):(r.textContent="",r.classList.remove("no-resultado","resultado-encontrado"))}function debounce(e,t){let a;return(...r)=>{clearTimeout(a),a=setTimeout(()=>e.apply(this,r),t)}}function buscarMarca(e){let t=document.getElementById("searchGeneral");t.value=e,t.dispatchEvent(new Event("input"))}document.getElementById("searchGeneral").addEventListener("input",debounce(filtrarGeneral,300)),document.getElementById("clearSearch").addEventListener("click",function(){let e=document.getElementById("searchGeneral");e.value="",e.dispatchEvent(new Event("input"))}),window.buscarMarca=buscarMarca;const faqModal=document.getElementById("faqModal");faqModal.addEventListener("hidden.bs.modal",()=>{document.querySelectorAll("#faqModal .accordion-collapse.show").forEach(e=>bootstrap.Collapse.getOrCreateInstance(e).hide())});
