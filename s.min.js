const csvUrl="https://docs.google.com/spreadsheets/d/e/2PACX-1vRr62BlKCzICpC0ctnU2mRB8cq_SOCcsgydXQJXD5pQvasO1b1iT0Wp_L7sFxH8UGJCepaMjng1GUO0/pub?gid=1610793698&single=true&output=csv",cotizacionUrl="https://docs.google.com/spreadsheets/d/e/2PACX-1vQJ7PS8pvnCKdpLgJFonsZNN54Rs8oTpzGgCxhbfZzd3KmKb9k12OEwgAWuDAHiIPraWKxoS5TlCm4X/pub?gid=0&single=true&output=csv";fetch(cotizacionUrl).then(e=>e.text()).then(e=>{const t=e.trim().split("\n");document.getElementById("dolarValor").textContent=t.length>0?t[0].split(",")[0].replace(",",".")||"N/A":"Sin datos"}).catch(e=>{document.getElementById("dolarValor").textContent="Error",console.error("Error al obtener d√≥lar:",e)});document.getElementById("fechaActual").textContent=new Intl.DateTimeFormat("es-AR").format(new Date);Papa.parse(csvUrl,{download:!0,skipEmptyLines:!0,complete:function(e){const t=e.data,r=[],n=null,o=!1;let a=n,l=o;t.forEach(e=>{const t=e[0]&&e.slice(1).every(e=>!e.trim());t?(a={nombre:e[0],headers:[],productos:[]},r.push(a),l=!0):l&&a?(a.headers=e,l=!1):a&&e.length>0&&(function(e,t){for(;e.length<t;)e.push("")}(e,a.headers.length),a.productos.push(e))}),renderCategorias(r)},error:function(e){console.error("Error al parsear CSV:",e)}});const iconosCategorias={IPHONE:"bi-apple",AIRPODS:"bi-earbuds","APPLE WATCH":"bi-smartwatch",AIRTAG:"bi-tag",IPAD:"bi-tablet-fill","MACBOOK AIR":"bi-laptop","MACBOOK PRO":"bi-laptop","SONY PLAYSTATION":"bi-playstation","MICROSOFT XBOX":"bi-xbox","NINTENDO SWITCH":"bi-nintendo-switch",VR:"bi-headset-vr"},badges={NEW:'<span class="badge bg-warning text-dark">‚úàÔ∏è¬°NUEVO!</span>',SALE:'<span class="badge bg-danger text-white">üî•¬°OFERTA!</span>',HOT:'<span class="badge bg-primary">üî• HOT</span>',LIMITED:'<span class="badge bg-info text-dark">‚è≥ Edici√≥n limitada</span>'};function renderCategorias(e){const t=document.getElementById("categoriasContainer");t.innerHTML="",e.forEach((e,n)=>{const o=`cat-${n}`,a=e.headers.indexOf("Ocultar"),l=iconosCategorias[e.nombre]||"bi bi-phone",c=document.createElement("div");c.className="accordion mb-1",c.innerHTML=`<div class="accordion-item border"><h2 class="accordion-header" id="heading-${o}"><button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-${o}" aria-expanded="false" aria-controls="collapse-${o}"><i class="${l} me-2"></i> ${e.nombre}</button></h2><div id="collapse-${o}" class="accordion-collapse collapse" aria-labelledby="heading-${o}"><div class="accordion-body">${renderAlerta(e.nombre)}<div class="table-responsive"><table class="table table-bordered table-sm text-center" id="tabla-${o}"><thead class="table-light"><tr>${e.headers.filter(e=>"Ocultar"!==e).map(e=>`<th>${e}</th>`).join("")}</tr></thead><tbody>${e.productos.filter(e=>-1===a||"x"!==e[a].toLowerCase()).map(e=>{if(e.every(e=>""===e))return`<tr><td colspan="${e.length-(a!==-1?1:0)}">&nbsp;</td></tr>`;return`<tr>${e.map((t,r)=>{if(r===a)return null;if("L"===e.headers?.[r]&&t)return`<td>${badges[t]||t}</td>`;const n=e.findIndex((e,r)=>r!==a)===r;return`<td>${n?`<strong>${t}</strong>`:t||"&nbsp;"}</td>`}).filter(e=>null!==e).join("")}</tr>`}).join("")}</tbody></table></div></div></div></div>`,t.appendChild(c)})}function renderAlerta(e){const t={"MACBOOK AIR":"Consultanos por versiones custom (Chip MAX, +RAM, etc). Tambi√©n traemos iMac, Mac mini, Mac Studio","MACBOOK PRO":"Consultanos por versiones custom (Chip MAX, +RAM, etc). Tambi√©n traemos iMac, Mac mini, Mac Studio",IPHONE:"¬°Combo cargador original (Apple 20W, MWVV3AM) + U$30!",SAMSUNG:"Por otros productos de la marca (Linea Z, Samsung Tab, etc) consultanos por WhatsApp"};return t[e]?`<div class="alert alert-warning d-flex align-items-center mb-3 py-2 px-3" role="alert"><i class="bi bi-info-circle-fill me-2"></i><div class="small">${t[e]}</div></div>`:""}let timeoutId;function filtrarGeneral(){clearTimeout(timeoutId),timeoutId=setTimeout(()=>{const e=document.getElementById("searchGeneral").value.toLowerCase().trim(),t=document.getElementById("resultadoBusqueda"),r=document.querySelectorAll(".accordion-item");let n=0;r.forEach(t=>{const r=t.querySelectorAll("tbody tr"),o=t.querySelector(".accordion-button").innerText.toLowerCase();let a=!1;r.forEach(t=>{const r=""===t.innerText.trim();if(""===e)t.style.display="";else if(r)t.style.display="none";else{const r=Array.from(t.cells).filter((e,t)=>2!==t).map(e=>e.innerText).join(" ").toLowerCase()+" "+o,l=e.split(" "),c=l.every(e=>r.includes(e));t.style.display=c?"":"none",c&&(a=!0,n++)}});const l=t.querySelector(".accordion-collapse");a||""===e?(t.style.display="",""!==e?l.classList.add("show"):l.classList.remove("show")):(t.style.display="none",l.classList.remove("show"))}),""===e?(t.textContent="",t.classList.remove("no-resultado","resultado-encontrado")):0===n?(t.textContent="Sin resultados. Consultar existencia por WhatsApp",t.classList.add("no-resultado"),t.classList.remove("resultado-encontrado")):(t.textContent=`${n} resultado${1!==n?"s":""} encontrado${1!==n?"s":""}`,t.classList.add("resultado-encontrado"),t.classList.remove("no-resultado"))},300)}document.getElementById("faqModal").addEventListener("hidden.bs.modal",()=>{document.querySelectorAll("#faqModal .accordion-collapse.show").forEach(e=>{new bootstrap.Collapse(e,{toggle:!1}).hide()})});

